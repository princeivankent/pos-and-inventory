<p-dialog
  [header]="statement ? 'Credit Statement - ' + statement.customer.name : 'Credit Statement'"
  [visible]="visible"
  (visibleChange)="onHide()"
  [modal]="true"
  [style]="{ width: '720px' }"
  [closable]="true"
>
  @if (loading) {
    <div class="loading-state">
      <p-progressSpinner [style]="{ width: '50px', height: '50px' }" />
    </div>
  } @else if (statement) {
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card">
        <span class="summary-label">Credit Limit</span>
        <span class="summary-value">{{ statement.summary.credit_limit | currency:'PHP':'symbol':'1.2-2' }}</span>
      </div>
      <div class="summary-card balance">
        <span class="summary-label">Current Balance</span>
        <span class="summary-value" [class.danger]="statement.summary.current_balance > 0">
          {{ statement.summary.current_balance | currency:'PHP':'symbol':'1.2-2' }}
        </span>
      </div>
      <div class="summary-card available">
        <span class="summary-label">Available Credit</span>
        <span class="summary-value success">{{ statement.summary.available_credit | currency:'PHP':'symbol':'1.2-2' }}</span>
      </div>
    </div>

    <!-- Transaction History -->
    @if (statement.transactions.length === 0) {
      <div class="empty-transactions">
        <i class="pi pi-inbox"></i>
        <p>No credit transactions yet.</p>
      </div>
    } @else {
      <p-table
        [value]="statement.transactions"
        [rows]="10"
        [paginator]="statement.transactions.length > 10"
        [rowHover]="true"
        styleClass="p-datatable-sm"
      >
        <ng-template #header>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Reference</th>
            <th class="text-right">Amount</th>
            <th class="text-right">Balance</th>
          </tr>
        </ng-template>
        <ng-template #body let-tx>
          <tr>
            <td>{{ tx.date | date:'MMM d, y h:mm a' }}</td>
            <td>
              <p-tag
                [value]="tx.type === 'sale' ? 'Credit Sale' : 'Payment'"
                [severity]="tx.type === 'sale' ? 'danger' : 'success'"
              />
            </td>
            <td>{{ tx.reference }}</td>
            <td class="text-right" [class.amount-charge]="tx.type === 'sale'" [class.amount-payment]="tx.type === 'payment'">
              {{ tx.type === 'sale' ? '+' : '-' }}{{ tx.amount | currency:'PHP':'symbol':'1.2-2' }}
            </td>
            <td class="text-right">{{ tx.running_balance | currency:'PHP':'symbol':'1.2-2' }}</td>
          </tr>
        </ng-template>
      </p-table>
    }
  }
</p-dialog>
