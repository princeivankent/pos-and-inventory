<app-page-header title="Products" subtitle="Manage your product catalog">
  <!-- View toggle buttons -->
  <p-buttonGroup>
    <p-button
      icon="pi pi-table"
      [outlined]="viewMode() !== 'table'"
      (onClick)="toggleView('table')"
      severity="secondary"
    />
    <p-button
      icon="pi pi-th-large"
      [outlined]="viewMode() !== 'cards'"
      (onClick)="toggleView('cards')"
      severity="secondary"
    />
  </p-buttonGroup>

  @if (storeCtx.isAdmin()) {
    <p-button label="Add Product" icon="pi pi-plus" (onClick)="openNew()" />
  }
</app-page-header>

<!-- Search and Filter Controls -->
<div class="page-controls">
  <!-- Search -->
  <app-product-search
    [allProducts]="products()"
    (productSelected)="onProductSelected($event)"
    (searchQueryChange)="onSearchQueryChange($event)"
    class="search-section"
  />

  <!-- Category filter -->
  <app-category-filter
    [categories]="categories()"
    [selectedCategoryId]="selectedCategoryId()"
    (categoryChange)="onCategoryChange($event)"
  />
</div>

<!-- Content -->
<div class="card">
  @if (viewMode() === 'table') {
    <!-- Table View -->
    <app-product-table
      [products]="filteredProducts()"
      [loading]="loading()"
      (edit)="editProduct($event)"
      (delete)="confirmDelete($event)"
    />
  } @else {
    <!-- Card Grid View -->
    @if (filteredProducts().length === 0) {
      <div class="empty-state-cards">
        <i class="pi pi-box"></i>
        <h3>No products found</h3>
        <p class="text-secondary">
          @if (selectedCategoryId()) {
            Try selecting a different category or clear the filter.
          } @else {
            Get started by adding your first product to the catalog.
          }
        </p>
        @if (storeCtx.isAdmin() && !selectedCategoryId()) {
          <p-button label="Add Product" icon="pi pi-plus" (onClick)="openNew()" />
        }
      </div>
    } @else {
      <div class="products-grid">
        @for (product of filteredProducts(); track product.id) {
          <app-product-card
            [product]="product"
            [categoryColor]="getCategoryColor(product)"
            [showActions]="storeCtx.isAdmin()"
            (edit)="editProduct($event)"
            (delete)="confirmDelete($event)"
            [attr.data-product-id]="product.id"
          />
        }
      </div>
    }
  }
</div>

<!-- Product Form Dialog -->
<app-product-form-dialog
  [(visible)]="dialogVisible"
  [editMode]="editMode"
  [form]="form"
  [categories]="categories()"
  [saving]="saving()"
  (save)="saveProduct()"
/>
