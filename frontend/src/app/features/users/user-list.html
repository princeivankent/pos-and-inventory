<app-page-header title="Users" subtitle="Manage store users and roles">
      <p-button label="Add User" icon="pi pi-plus" (onClick)="openNew()" />
    </app-page-header>

    <div class="card">
      <p-table [value]="users()" [loading]="loading()" dataKey="id">
        <ng-template pTemplate="header">
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th style="width:120px">Actions</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-user>
          <tr>
            <td class="font-medium">{{ user.full_name }}</td>
            <td>{{ user.email }}</td>
            <td>
              <app-status-badge
                [label]="user.role"
                [severity]="user.role === 'admin' ? 'info' : 'neutral'"
              />
            </td>
            <td>
              <app-status-badge
                [label]="user.is_active ? 'Active' : 'Inactive'"
                [severity]="user.is_active ? 'success' : 'danger'"
              />
            </td>
            <td>
              <div class="flex gap-2">
                <p-button icon="pi pi-pencil" [rounded]="true" [text]="true" severity="info" (onClick)="editRole(user)" />
                <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger" (onClick)="confirmDeactivate(user)" />
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="empty-state">
              <div class="empty-content">
                <i class="pi pi-user" style="font-size: 3rem; color: #d1d5db;"></i>
                <h3>No users found</h3>
                <p class="text-secondary">
                  Add users to manage your store operations.
                </p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <!-- Create User Dialog -->
    <p-dialog
      [(visible)]="createDialogVisible"
      header="Add User"
      [modal]="true"
      [style]="{ width: '420px' }"
    >
      <div class="form-grid">
        <div class="field">
          <label>Email *</label>
          <input pInputText [(ngModel)]="createForm.email" class="w-full" type="email" />
        </div>
        <div class="field">
          <label>Full Name *</label>
          <input pInputText [(ngModel)]="createForm.full_name" class="w-full" />
        </div>
        <div class="field">
          <label>Password *</label>
          <input pInputText [(ngModel)]="createForm.password" class="w-full" type="password" />
        </div>
        <div class="field">
          <label>Role</label>
          <p-select
            [(ngModel)]="createForm.role"
            [options]="roleOptions"
            optionLabel="label"
            optionValue="value"
            styleClass="w-full"
            appendTo="body"
          />
        </div>
      </div>

      <ng-template pTemplate="footer">
        <p-button label="Cancel" [text]="true" severity="secondary" (onClick)="createDialogVisible = false" />
        <p-button
          label="Create"
          icon="pi pi-check"
          (onClick)="createUser()"
          [loading]="saving()"
          [disabled]="!createForm.email || !createForm.full_name || !createForm.password"
        />
      </ng-template>
    </p-dialog>

    <!-- Edit Role Dialog -->
    <p-dialog
      [(visible)]="roleDialogVisible"
      header="Change Role"
      [modal]="true"
      [style]="{ width: '350px' }"
    >
      @if (editingUser) {
        <div class="form-grid">
          <p>Change role for <strong>{{ editingUser.full_name }}</strong></p>
          <div class="field">
            <label>Role</label>
            <p-select
              [(ngModel)]="newRole"
              [options]="roleOptions"
              optionLabel="label"
              optionValue="value"
              styleClass="w-full"
              appendTo="body"
            />
          </div>
        </div>
      }

      <ng-template pTemplate="footer">
        <p-button label="Cancel" [text]="true" severity="secondary" (onClick)="roleDialogVisible = false" />
        <p-button label="Update" icon="pi pi-check" (onClick)="updateRole()" [loading]="saving()" />
      </ng-template>
    </p-dialog>
